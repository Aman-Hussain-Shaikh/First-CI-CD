name: Deploy to Netlify

on:
  push:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Validate HTML file exists
      run: |
        if [ ! -f "index.html" ]; then
          echo "❌ index.html missing"
          exit 1
        fi
        echo "✓ index.html found"

    - name: Basic content tests
      run: |
        grep -q "<title>" index.html && echo "✓ Title OK" || exit 1
        grep -q "incrementCounter" index.html && echo "✓ JS OK" || exit 1
        grep -q "class=\"card\"" index.html && echo "✓ Cards OK" || exit 1

  deploy:
    runs-on: ubuntu-latest
    needs: test

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install Netlify CLI
      run: npm install -g netlify-cli

    - name: Deploy to Netlify via CLI
      run: netlify deploy --prod --dir="." --message "GitHub Actions Deploy"
      env:
        NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
